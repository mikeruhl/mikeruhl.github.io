{"componentChunkName":"component---src-templates-blog-post-js","path":"/access-your-ad-object-id-in-terraform/","result":{"data":{"site":{"siteMetadata":{"title":"Mike Ruhl's Dev Dream Journal"}},"markdownRemark":{"id":"969ceded-56ae-58ac-9430-e706bf382521","excerpt":"I ran into an issue today trying to use the azurerm provider in Terraform. I needed to create a Key Vault, then add myself as an access policy so that in the…","html":"<p>I ran into an issue today trying to use the azurerm provider in Terraform. I needed to create a Key Vault, then add myself as an access policy so that in the same .tf I could add a certificate. Once I saw a <a href=\"https://serverfault.com/a/970269/526579\">similarly frustrated user</a> on Serverfault, I decided to figure this out.</p>\n<p>What I came up with was a powershell script that used the az cli to get the current user’s object id.</p>\n<p>Here is a demo of the solution, also posted as my answer:</p>\n<p>There is a way to do this using the Azure CLI. Here is a demo:</p>\n<p>Powershell Script:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\">#scripts/getuser.ps1</span>\n<span class=\"token variable\">$t</span> = az ad signed<span class=\"token operator\">-in</span><span class=\"token operator\">-</span>user show\n<span class=\"token variable\">$t</span> = <span class=\"token string\">\"<span class=\"token variable\">$t</span>\"</span>\n<span class=\"token variable\">$j</span> = <span class=\"token function\">ConvertFrom-Json</span> <span class=\"token variable\">$t</span>\n<span class=\"token function\">Write-Output</span> <span class=\"token string\">\"{`\"object_id`\":`\"<span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$j</span><span class=\"token punctuation\">.</span>objectId<span class=\"token punctuation\">)</span></span>`\"}\"</span></code></pre></div>\n<p><br/><br/>\nTerraform:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token comment\">//main.tf</span>\n<span class=\"token keyword\">provider<span class=\"token type variable\"> \"azurerm\" </span></span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">subscription_id</span> <span class=\"token punctuation\">=</span> var.subscription_id\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">data <span class=\"token type variable\">\"external\"</span></span> <span class=\"token string\">\"user\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">program</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"powershell.exe\"</span>, <span class=\"token string\">\"<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">path</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">module</span><span class=\"token punctuation\">}</span></span>/scripts/getuser.ps1\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">output<span class=\"token type variable\"> \"object_id\" </span></span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> data.external.user.result.object_id\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Keep in mind <code class=\"language-text\">az ad signed-in-user</code> is fairly new so make sure everything is up to date.</p>\n<p>Resources:</p>\n<p><a href=\"https://docs.microsoft.com/en-us/cli/azure/ad/signed-in-user?view=azure-cli-latest\">https://docs.microsoft.com/en-us/cli/azure/ad/signed-in-user?view=azure-cli-latest</a></p>\n<p><a href=\"https://www.terraform.io/docs/providers/external/data_source.html\">https://www.terraform.io/docs/providers/external/data_source.html</a></p>","frontmatter":{"title":"Access your Azure AD Object ID in Terraform","date":"June 05, 2019","description":"import from previous blog."}}},"pageContext":{"slug":"/access-your-ad-object-id-in-terraform/","previous":{"fields":{"slug":"/convert-repository-files-to-utf8/"},"frontmatter":{"title":"Convert repository files to UTF8"}},"next":null}},"staticQueryHashes":["1246554614","2841359383"]}